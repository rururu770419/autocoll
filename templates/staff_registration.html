<!-- templates/staff_list.html - ã‚¹ã‚¿ãƒƒãƒ•ä¸€è¦§è¡¨ç¤ºï¼ˆæ—¢å­˜ã®stiff_registration.htmlã‹ã‚‰æ”¹ä¿®ï¼‰ -->
{% extends "base.html" %}

{% block extra_head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/staff_management.css') }}">
{% endblock %}

{% block title %}
  ã‚¹ã‚¿ãƒƒãƒ•ä¸€è¦§ | {{ display_name }}
{% endblock %}

{% block content %}
<div class="container">
  <h1>ã‚¹ã‚¿ãƒƒãƒ•ç®¡ç†</h1>

  {% if success %}
    <div class="alert alert-success">{{ success }}</div>
  {% endif %}
  {% if error %}
    <div class="alert alert-danger">{{ error }}</div>
  {% endif %}

  <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ -->
  <div class="staff-list-actions" style="margin-bottom: 25px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;">
    <a href="{{ url_for('main_routes.new_staff', store=store) }}" class="btn btn-success" style="margin-bottom: 10px;">
      + æ–°è¦ã‚¹ã‚¿ãƒƒãƒ•ç™»éŒ²
    </a>
    <div class="staff-list-summary" style="color: #666; font-size: 14px; margin-bottom: 10px;">
      ç™»éŒ²ã‚¹ã‚¿ãƒƒãƒ•æ•°: <strong>{{ users|length }}å</strong>
    </div>
  </div>

  <!-- ã‚¹ã‚¿ãƒƒãƒ•ä¸€è¦§ãƒ†ãƒ¼ãƒ–ãƒ« -->
  <div class="table-responsive">
    {% if users %}
      <table class="table table-striped staff-list-table">
        <thead>
          <tr>
            <th style="width: 15%;">åå‰</th>
            <th style="width: 10%;">ã‚«ãƒ©ãƒ¼</th>
            <th style="width: 15%;">ãƒ­ã‚°ã‚¤ãƒ³ID</th>
            <th style="width: 10%;">æ¨©é™</th>
            <th style="width: 12%;">LINEé€£æº</th>
            <th style="width: 10%;">é€šçŸ¥è¨­å®š</th>
            <th style="width: 8%;">é€šçŸ¥æ™‚é–“</th>
            <th style="width: 20%;">æ“ä½œ</th>
          </tr>
        </thead>
        <tbody>
          {% for user in users %}
          <tr class="staff-list-row">
            <td class="staff-name-cell">
              <strong>{{ user.name if user.name else user[0] }}</strong>
            </td>
            <td class="staff-color-cell">
              {% set color_value = user.color if user.color else (user[4] if user|length > 4 else '#FFE5E5') %}
              <div style="display: flex; align-items: center; gap: 8px;">
                <div style="width: 25px; height: 15px; background-color: {{ color_value }}; border: 1px solid #ccc; border-radius: 3px;"></div>
                <span style="font-size: 11px; color: #666;">{{ color_value }}</span>
              </div>
            </td>
            <td class="staff-login-cell">{{ user.login_id if user.login_id else (user[1] if user|length > 1 else '') }}</td>
            <td class="staff-role-cell">
              <span class="staff-role-badge" style="padding: 2px 8px; border-radius: 12px; font-size: 12px; {{ 'background-color: #e3f2fd; color: #1565c0;' if (user.role if user.role else (user[3] if user|length > 3 else '')) == 'ãƒ‰ãƒ©ã‚¤ãƒãƒ¼' else 'background-color: #f3e5f5; color: #7b1fa2;' }}">
                {{ user.role if user.role else (user[3] if user|length > 3 else '') }}
              </span>
            </td>
            <td class="staff-line-status-cell">
              {% set line_id = user.line_id if user.line_id else (user[5] if user|length > 5 and user[5] else '') %}
              {% if line_id %}
                <span class="line-status-connected" style="color: #28a745; font-weight: bold; font-size: 12px;">âœ“ é€£æºæ¸ˆã¿</span>
              {% else %}
                <span class="line-status-not-connected" style="color: #dc3545; font-size: 12px;">æœªè¨­å®š</span>
              {% endif %}
            </td>
            <td class="staff-notification-cell">
              {% set notification_enabled = user.line_notification_enabled if user.line_notification_enabled is defined else (user[7] if user|length > 7 and user[7] else 0) %}
              {% if notification_enabled %}
                <span style="color: #28a745; font-size: 12px;">ğŸ”” ON</span>
              {% else %}
                <span style="color: #666; font-size: 12px;">ğŸ”• OFF</span>
              {% endif %}
            </td>
            <td class="staff-notification-time-cell">
              {% set minutes_before = user.notification_minutes_before if user.notification_minutes_before is defined else (user[6] if user|length > 6 and user[6] else 10) %}
              <span style="font-size: 12px; color: #666;">{{ minutes_before }}åˆ†å‰</span>
            </td>
            <td class="staff-actions-cell">
              <!-- IDãƒ™ãƒ¼ã‚¹ã§ã®ãƒªãƒ³ã‚¯ï¼ˆrowidã‚’ä½¿ç”¨ï¼‰ -->
              {% set user_id = user.id if user.id is defined else (user[0] if user|length > 0 and user[0] else loop.index) %}
              <a href="{{ url_for('main_routes.edit_staff', store=store, user_id=user_id) }}" class="btn btn-edit" style="margin-right: 5px;">ç·¨é›†</a>
              <form method="post" action="{{ url_for('main_routes.delete_staff', store=store, user_id=user_id) }}" style="display: inline;" onsubmit="return confirm('æœ¬å½“ã«{{ user.name if user.name else user[0] }}ã•ã‚“ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ');">
                <button type="submit" class="btn btn-delete">å‰Šé™¤</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      
      <!-- LINEé€šçŸ¥ã«é–¢ã™ã‚‹èª¬æ˜ -->
      <div class="staff-line-info" style="margin-top: 25px; padding: 15px; background-color: #f8f9fa; border-radius: 8px; border-left: 4px solid #007bff;">
        <h3 style="margin: 0 0 10px 0; color: #007bff; font-size: 16px;">ğŸ’¬ LINEé€šçŸ¥æ©Ÿèƒ½ã«ã¤ã„ã¦</h3>
        <ul style="margin: 0; padding-left: 20px; font-size: 14px; color: #666;">
          <li>å„ã‚¹ã‚¿ãƒƒãƒ•ãŒå€‹åˆ¥ã«LINE Botã‚’å‹ã ã¡è¿½åŠ ã—ã¦è¨­å®šã§ãã¾ã™</li>
          <li>é€è¿æ™‚é–“ã®æŒ‡å®šåˆ†å‰ã«è‡ªå‹•é€šçŸ¥ã•ã‚Œã¾ã™</li>
          <li>é€šçŸ¥æ™‚é–“ã¯å€‹åˆ¥ã«è¨­å®šå¯èƒ½ã§ã™ï¼ˆ10åˆ†å‰ã€15åˆ†å‰ãªã©ï¼‰</li>
          <li>é€šçŸ¥ã®ON/OFFåˆ‡ã‚Šæ›¿ãˆã‚‚å€‹åˆ¥ã«è¨­å®šã§ãã¾ã™</li>
        </ul>
      </div>
      
    {% else %}
      <div class="staff-empty-state" style="text-align: center; padding: 60px 20px; background-color: #f8f9fa; border-radius: 8px;">
        <div style="font-size: 48px; color: #ccc; margin-bottom: 20px;">ğŸ‘¥</div>
        <h3 style="color: #666; margin-bottom: 10px;">ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã‚¹ã‚¿ãƒƒãƒ•ã¯ã„ã¾ã›ã‚“</h3>
        <p style="color: #999; margin-bottom: 25px;">æ–°è¦ã‚¹ã‚¿ãƒƒãƒ•ç™»éŒ²ã‹ã‚‰å§‹ã‚ã¦ãã ã•ã„</p>
        <a href="{{ url_for('main_routes.new_staff', store=store) }}" class="btn btn-success">æœ€åˆã®ã‚¹ã‚¿ãƒƒãƒ•ã‚’ç™»éŒ²ã™ã‚‹</a>
      </div>
    {% endif %}
  </div>
</div>


{% endblock %}

<!-- templates/staff_edit.html - ã‚¹ã‚¿ãƒƒãƒ•ç·¨é›†ãƒ»æ–°è¦ç™»éŒ²ãƒšãƒ¼ã‚¸ -->
{% extends "base.html" %}

{% block title %}
  {% if mode == 'new' %}æ–°è¦ã‚¹ã‚¿ãƒƒãƒ•ç™»éŒ²{% else %}{{ user.name }}ã•ã‚“ã®ç·¨é›†{% endif %} | {{ display_name }}
{% endblock %}

{% block content %}
<div class="container">
  <h1>
    {% if mode == 'new' %}
      æ–°è¦ã‚¹ã‚¿ãƒƒãƒ•ç™»éŒ²
    {% else %}
      {{ user.name }}ã•ã‚“ã®ç·¨é›†
    {% endif %}
  </h1>

  {% if success %}
    <div class="alert alert-success">{{ success }}</div>
  {% endif %}
  {% if error %}
    <div class="alert alert-danger">{{ error }}</div>
  {% endif %}

  <!-- æˆ»ã‚‹ãƒœã‚¿ãƒ³ -->
  <div style="margin-bottom: 25px;">
    <a href="{{ url_for('main_routes.register_staff', store=store) }}" class="btn btn-secondary">â† ã‚¹ã‚¿ãƒƒãƒ•ä¸€è¦§ã«æˆ»ã‚‹</a>
  </div>

  <div class="row">
    <!-- åŸºæœ¬æƒ…å ±ãƒ•ã‚©ãƒ¼ãƒ  -->
    <div class="col-left">
      <div class="card">
        <div class="card-body">
          <h2>{% if mode == 'new' %}åŸºæœ¬æƒ…å ±ç™»éŒ²{% else %}åŸºæœ¬æƒ…å ±ç·¨é›†{% endif %}</h2>
          
          <form method="post" action="{{ url_for('main_routes.save_staff', store=store) }}" class="staff-edit-form">
            {% if mode == 'edit' %}
              <input type="hidden" name="user_id" value="{{ user.id }}">
            {% endif %}
            
            <!-- åŸºæœ¬æƒ…å ± -->
            <div class="form-group">
              <label for="name" class="form-label">åå‰ <span style="color: red;">*</span></label>
              <input type="text" class="form-control" id="name" name="name" 
                     value="{{ user.name if user else '' }}" required placeholder="ä¾‹ï¼‰åº—é•·">
            </div>
            
            <div class="form-group">
              <label for="color" class="form-label">ã‚«ãƒ©ãƒ¼:</label>
              <div style="display: flex; align-items: center; gap: 10px;">
                <input type="color" class="form-control" id="color" name="color" 
                       value="{{ user.color if user and user.color else '#FFE5E5' }}" required 
                       style="width: 60px; height: 40px; padding: 0; border: 1px solid #ccc;">
                <span id="color-preview" style="padding: 5px 10px; border: 1px solid #ccc; border-radius: 3px; background-color: {{ user.color if user and user.color else '#FFE5E5' }};">é¸æŠã—ãŸè‰²</span>
              </div>
            </div>
            
            <div class="form-group">
              <label for="login_id" class="form-label">ãƒ­ã‚°ã‚¤ãƒ³ID <span style="color: red;">*</span></label>
              <input type="text" class="form-control" id="login_id" name="login_id" 
                     value="{{ user.login_id if user else '' }}" required placeholder="åŠè§’è‹±æ•°å­—" autocomplete="new-username">
            </div>
            
            <div class="form-group">
              <label for="password" class="form-label">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ <span style="color: red;">*</span></label>
              <input type="password" class="form-control" id="password" name="password" 
                     value="{{ user.password if user else '' }}" required placeholder="åŠè§’è‹±æ•°å­—" autocomplete="new-password">
            </div>
            
            <div class="form-group">
              <label class="form-label">æ¨©é™ <span style="color: red;">*</span></label>
              <div style="display: flex; gap: 15px; margin-top: 8px;">
                <div class="form-check form-check-inline">
                  <input type="radio" class="form-check-input" id="role_staff" name="role" value="ã‚¹ã‚¿ãƒƒãƒ•"
                         {% if user and user.role == 'ã‚¹ã‚¿ãƒƒãƒ•' %}checked{% endif %}>
                  <label class="form-check-label" for="role_staff">ã‚¹ã‚¿ãƒƒãƒ•</label>
                </div>
                <div class="form-check form-check-inline">
                  <input type="radio" class="form-check-input" id="role_driver" name="role" value="ãƒ‰ãƒ©ã‚¤ãƒãƒ¼"
                         {% if not user or user.role == 'ãƒ‰ãƒ©ã‚¤ãƒãƒ¼' %}checked{% endif %} required>
                  <label class="form-check-label" for="role_driver">ãƒ‰ãƒ©ã‚¤ãƒãƒ¼</label>
                </div>
              </div>
            </div>
            
            <button type="submit" class="btn-register">
              {% if mode == 'new' %}ç™»éŒ²{% else %}æ›´æ–°{% endif %}
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- LINEé€šçŸ¥è¨­å®š -->
    <div class="col-right">
      <div class="card">
        <div class="card-body">
          <h2>ğŸ”” LINEé€šçŸ¥è¨­å®š</h2>
          
          <!-- QRã‚³ãƒ¼ãƒ‰è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
          <div class="line-setup-section" style="margin-bottom: 25px;">
            <h3 style="font-size: 16px; margin-bottom: 15px; color: #007bff;">ğŸ“± Botå‹ã ã¡è¿½åŠ </h3>
            <div class="line-qr-container" style="text-align: center; padding: 20px; background-color: #f8f9fa; border-radius: 8px; margin-bottom: 15px;">
              <!-- å®Ÿéš›ã®QRã‚³ãƒ¼ãƒ‰ã«å¤‰æ›´ã—ã¦ãã ã•ã„ -->
              <div style="width: 150px; height: 150px; margin: 0 auto; background-color: white; border: 2px solid #ddd; display: flex; align-items: center; justify-content: center; border-radius: 8px;">
                <span style="color: #999; font-size: 12px;">QRã‚³ãƒ¼ãƒ‰</span>
              </div>
              <p style="margin: 15px 0 5px 0; font-size: 14px; color: #666;">ä¸Šè¨˜QRã‚³ãƒ¼ãƒ‰ã§Botå‹ã ã¡è¿½åŠ </p>
              <a href="https://line.me/R/ti/p/@your_bot_id" target="_blank" class="btn btn-info" style="font-size: 12px; padding: 6px 12px;">ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã</a>
            </div>
            
            <div class="line-instructions" style="font-size: 13px; color: #666;">
              <p style="margin: 0 0 8px 0;"><strong>è¨­å®šæ‰‹é †:</strong></p>
              <ol style="margin: 0; padding-left: 18px;">
                <li>ä¸Šè¨˜QRã‚³ãƒ¼ãƒ‰ã§Botã‚’å‹ã ã¡è¿½åŠ </li>
                <li>Botã«ã€Œ<strong>ID</strong>ã€ã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡</li>
                <li>è¿”ä¿¡ã•ã‚ŒãŸUser IDï¼ˆUã§å§‹ã¾ã‚‹æ–‡å­—åˆ—ï¼‰ã‚’ã‚³ãƒ”ãƒ¼</li>
                <li>ä¸‹è¨˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«è²¼ã‚Šä»˜ã‘</li>
              </ol>
            </div>
          </div>

          <!-- LINEè¨­å®šãƒ•ã‚©ãƒ¼ãƒ  -->
          <form method="post" action="{{ url_for('main_routes.save_staff', store=store) }}" class="line-notification-form">
            {% if mode == 'edit' %}
              <input type="hidden" name="user_id" value="{{ user.id }}">
            {% endif %}
            <!-- åŸºæœ¬æƒ…å ±ã‚’éš ã—ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§ä¿æŒ -->
            <input type="hidden" name="name" value="{{ user.name if user else '' }}">
            <input type="hidden" name="login_id" value="{{ user.login_id if user else '' }}">
            <input type="hidden" name="password" value="{{ user.password if user else '' }}">
            <input type="hidden" name="role" value="{{ user.role if user else 'ãƒ‰ãƒ©ã‚¤ãƒãƒ¼' }}">
            <input type="hidden" name="color" value="{{ user.color if user else '#FFE5E5' }}">
            
            <div class="form-group">
              <label for="line_id" class="form-label">LINE User ID</label>
              <input type="text" class="form-control" id="line_id" name="line_id" 
                     value="{{ user.line_id if user and user.line_id else '' }}" 
                     placeholder="U1a2b3c4d5e6f7g8h9... (Uã§å§‹ã¾ã‚‹æ–‡å­—åˆ—)">
              <small class="form-text text-muted">Botã‹ã‚‰ã®è¿”ä¿¡ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„</small>
            </div>
            
            <div class="form-group">
              <label for="notification_minutes_before" class="form-label">é€šçŸ¥ã‚¿ã‚¤ãƒŸãƒ³ã‚°</label>
              <select class="form-control" id="notification_minutes_before" name="notification_minutes_before">
                <option value="5" {% if user and user.notification_minutes_before == 5 %}selected{% endif %}>5åˆ†å‰</option>
                <option value="10" {% if not user or user.notification_minutes_before == 10 %}selected{% endif %}>10åˆ†å‰</option>
                <option value="15" {% if user and user.notification_minutes_before == 15 %}selected{% endif %}>15åˆ†å‰</option>
                <option value="20" {% if user and user.notification_minutes_before == 20 %}selected{% endif %}>20åˆ†å‰</option>
                <option value="30" {% if user and user.notification_minutes_before == 30 %}selected{% endif %}>30åˆ†å‰</option>
              </select>
            </div>
            
            <div class="form-group">
              <div class="form-check">
                <input type="checkbox" class="form-check-input" id="line_notification_enabled" name="line_notification_enabled"
                       {% if not user or user.line_notification_enabled %}checked{% endif %}>
                <label class="form-check-label" for="line_notification_enabled">
                  LINEé€šçŸ¥ã‚’æœ‰åŠ¹ã«ã™ã‚‹
                </label>
              </div>
            </div>
            
            <button type="submit" class="btn btn-success" style="width: 100%; margin-top: 15px;">
              LINEè¨­å®šã‚’ä¿å­˜
            </button>
          </form>
          
          <!-- è¨­å®šçŠ¶æ³è¡¨ç¤º -->
          {% if user and user.line_id %}
          <div class="line-status-display" style="margin-top: 25px; padding: 15px; background-color: #d4edda; border-radius: 8px; border-left: 4px solid #28a745;">
            <h4 style="margin: 0 0 10px 0; color: #155724; font-size: 14px;">âœ… LINEé€£æºæ¸ˆã¿</h4>
            <p style="margin: 0; font-size: 13px; color: #155724;">
              User ID: {{ user.line_id[:15] }}...<br>
              é€šçŸ¥: {{ 'æœ‰åŠ¹' if user.line_notification_enabled else 'ç„¡åŠ¹' }} ({{ user.notification_minutes_before }}åˆ†å‰)
            </p>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// ã‚«ãƒ©ãƒ¼ãƒ”ãƒƒã‚«ãƒ¼ã®å¤‰æ›´ã‚’ç›£è¦–ã—ã¦ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æ›´æ–°
document.addEventListener('DOMContentLoaded', function() {
    const colorInput = document.getElementById('color');
    const colorPreview = document.getElementById('color-preview');
    
    if (colorInput && colorPreview) {
        colorInput.addEventListener('input', function() {
            colorPreview.style.backgroundColor = this.value;
            colorPreview.textContent = this.value;
        });
    }
});
</script>


{% endblock %}