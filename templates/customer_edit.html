{% extends "base.html" %}

{% block extra_head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/customer.css') }}">
<script src="{{ url_for('static', filename='js/address.js') }}" defer></script>
<script src="{{ url_for('static', filename='js/customer_edit.js') }}" defer></script>
{% endblock %}
{% block title %}顧客編集 - {{ display_name }}{% endblock %}

{% block content %}
<div class="customer-container">
    <!-- ヘッダー -->
    <div class="customer-header">
        <div class="customer-title-area">
            <h1>顧客編集</h1>
            <a href="{{ url_for('main_routes.customer_management', store=store) }}" class="customer-back-btn">
                ← 一覧に戻る
            </a>
        </div>
    </div>

    <!-- メッセージエリア -->
    <div id="messageArea"></div>

    <!-- フォームエリア -->
    <div class="customer-form-container">
        <form id="customerForm" class="customer-form">
            <input type="hidden" id="customerId" value="{{ customer_id }}">
            
            <!-- 1行目：名前、フリガナ、電話番号、ポイント -->
            <div class="customer-form-grid-4">
                <div class="customer-form-group">
                    <label class="customer-label customer-label-required customer-label-name">名前</label>
                    <input type="text" name="name" id="name" class="customer-input" required>
                </div>
                
                <div class="customer-form-group">
                    <label class="customer-label customer-label-furigana">フリガナ</label>
                    <input type="text" name="furigana" id="furigana" class="customer-input">
                </div>
                
                <div class="customer-form-group">
                    <label class="customer-label customer-label-phone">電話番号</label>
                    <input type="tel" name="phone" id="phone" class="customer-input" 
                           placeholder="09012345678" pattern="[0-9]{11}" maxlength="11" 
                           inputmode="numeric" title="数字11桁で入力してください">
                </div>
                
                <div class="customer-form-group">
                    <label class="customer-label customer-label-points">現在の所持PT</label>
                    <div class="customer-input-group">
                        <input type="number" name="current_points" id="current_points" class="customer-input" 
                               value="0" min="0" step="1" inputmode="numeric">
                        <span class="customer-input-suffix">pt</span>
                    </div>
                </div>
            </div>

            <!-- 2行目：会員種別、ステータス、web会員、生年月日・年齢 -->
            <div class="customer-form-grid-4">
                <div class="customer-form-group">
                    <label class="customer-label customer-label-member-type">会員種別</label>
                    <select name="member_type" id="member_type" class="customer-select">
                        <!-- JavaScriptで動的生成 -->
                    </select>
                </div>
                
                <div class="customer-form-group">
                    <label class="customer-label customer-label-status">ステータス</label>
                    <select name="status" id="status" class="customer-select">
                        <!-- JavaScriptで動的生成 -->
                    </select>
                </div>
                
                <div class="customer-form-group">
                    <label class="customer-label customer-label-web-member">WEB会員</label>
                    <select name="web_member" id="web_member" class="customer-select">
                        <!-- JavaScriptで動的生成 -->
                    </select>
                </div>
                
                <div class="customer-form-group">
                    <label class="customer-label customer-label-birthday">生年月日・年齢</label>
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <input type="date" name="birthday" id="birthday" class="customer-input" style="flex: 1;">
                        <input type="text" id="age" class="customer-input customer-input-readonly" 
                               readonly placeholder="自動" style="width: 60px;">
                    </div>
                </div>
            </div>

            <!-- 3行目：住所（3列分）、顧客番号（1列分） -->
            <div class="customer-form-grid-4">
                <div class="customer-form-group customer-form-group-span3">
                    <label class="customer-label customer-label-address">住所</label>
                    <div style="display: flex; gap: 0;">
                        <select name="prefecture" id="prefecture" class="customer-select" style="width: 150px; border-radius: 4px 0 0 4px;">
                            <option value="">選択してください</option>
                            <option value="北海道">北海道</option>
                            <option value="青森県">青森県</option>
                            <option value="岩手県">岩手県</option>
                            <option value="宮城県">宮城県</option>
                            <option value="秋田県">秋田県</option>
                            <option value="山形県">山形県</option>
                            <option value="福島県">福島県</option>
                            <option value="茨城県">茨城県</option>
                            <option value="栃木県">栃木県</option>
                            <option value="群馬県">群馬県</option>
                            <option value="埼玉県">埼玉県</option>
                            <option value="千葉県">千葉県</option>
                            <option value="東京都">東京都</option>
                            <option value="神奈川県">神奈川県</option>
                            <option value="新潟県">新潟県</option>
                            <option value="富山県">富山県</option>
                            <option value="石川県">石川県</option>
                            <option value="福井県">福井県</option>
                            <option value="山梨県">山梨県</option>
                            <option value="長野県">長野県</option>
                            <option value="岐阜県">岐阜県</option>
                            <option value="静岡県">静岡県</option>
                            <option value="愛知県">愛知県</option>
                            <option value="三重県">三重県</option>
                            <option value="滋賀県">滋賀県</option>
                            <option value="京都府">京都府</option>
                            <option value="大阪府">大阪府</option>
                            <option value="兵庫県">兵庫県</option>
                            <option value="奈良県">奈良県</option>
                            <option value="和歌山県">和歌山県</option>
                            <option value="鳥取県">鳥取県</option>
                            <option value="島根県">島根県</option>
                            <option value="岡山県">岡山県</option>
                            <option value="広島県">広島県</option>
                            <option value="山口県">山口県</option>
                            <option value="徳島県">徳島県</option>
                            <option value="香川県">香川県</option>
                            <option value="愛媛県">愛媛県</option>
                            <option value="高知県">高知県</option>
                            <option value="福岡県">福岡県</option>
                            <option value="佐賀県">佐賀県</option>
                            <option value="長崎県">長崎県</option>
                            <option value="熊本県">熊本県</option>
                            <option value="大分県">大分県</option>
                            <option value="宮崎県">宮崎県</option>
                            <option value="鹿児島県">鹿児島県</option>
                            <option value="沖縄県">沖縄県</option>
                        </select>
                        
                        <select name="city" id="city" class="customer-select" style="width: 200px; border-radius: 0; border-left: none;">
                            <option value="">都道府県を選択してください</option>
                        </select>
                        
                        <textarea name="address_detail" id="address_detail" class="customer-textarea" 
                                  rows="1" placeholder="番地・建物名等" style="flex: 1; border-radius: 0 4px 4px 0; border-left: none; resize: none;"></textarea>
                    </div>
                </div>
                
                <div class="customer-form-group">
                    <label class="customer-label customer-label-customer-id">顧客番号</label>
                    <input type="text" name="customer_number" id="customer_number" 
                           class="customer-input customer-input-readonly" readonly>
                </div>
            </div>

            <!-- 4行目:コメント（フルワイド） -->
            <div class="customer-form-grid-4">
                <div class="customer-form-group customer-form-group-span4">
                    <label class="customer-label customer-label-comment">コメント</label>
                    <textarea name="comment" id="comment" class="customer-textarea" 
                              rows="1" placeholder="備考・メモなど"></textarea>
                </div>
            </div>

            <!-- 5行目：マイページID、パスワード、募集媒体、ニックネーム -->
            <div class="customer-form-grid-4">
                <div class="customer-form-group">
                    <label class="customer-label customer-label-mypage-id">マイページID</label>
                    <input type="text" name="mypage_id" id="mypage_id" class="customer-input" 
                           placeholder="ログインID" autocomplete="off" 
                           pattern="[a-zA-Z0-9_\-@.]+" title="半角英数字、記号（_ - @ .）のみ">
                </div>
                
                <div class="customer-form-group">
                    <label class="customer-label customer-label-password">マイページパスワード</label>
                    <input type="text" name="mypage_password" id="mypage_password" class="customer-input" 
                           placeholder="変更する場合のみ入力" autocomplete="new-password" 
                           pattern="[\x20-\x7E]+" title="半角文字のみ">
                </div>
                
                <div class="customer-form-group">
                    <label class="customer-label customer-label-recruitment">募集媒体</label>
                    <select name="recruitment_source" id="recruitment_source" class="customer-select">
                        <!-- JavaScriptで動的生成 -->
                    </select>
                </div>
                
                <div class="customer-form-group">
                    <label class="customer-label customer-label-nickname">ニックネーム</label>
                    <input type="text" name="nickname" id="nickname" class="customer-input" 
                           placeholder="呼び名など">
                </div>
            </div>

            <!-- 保存・削除ボタン -->
            <div class="customer-form-actions">
                <button type="submit" class="customer-submit-btn">
                    更新する
                </button>
                <a href="{{ url_for('main_routes.customer_management', store=store) }}" 
                   class="customer-cancel-btn">
                    キャンセル
                </a>
                <button type="button" onclick="deleteCustomer()" class="customer-btn customer-btn-danger" 
                        style="margin-left: auto;">
                    削除
                </button>
            </div>
        </form>
    </div>
</div>

{% endblock %}