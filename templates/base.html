<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='common.css') }}">
    {% block extra_head %}{% endblock %}
</head>
<body>

    <header class="header">
        <button class="hamburger-menu">
            <span class="line"></span>
            <span class="line"></span>
            <span class="line"></span>
        </button>
        <div class="user-info">
            <span class="user-name">{{ session['user_name'] }}</span> ã•ã‚“
        </div>
    </header>

    <!-- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ï¼ˆã‚¹ãƒãƒ›ç‰ˆã®ã¿ï¼‰ -->
    <div class="nav-overlay"></div>

    <nav class="nav-menu">
        <ul>
            <li><a href="{{ url_for('main_routes.store_home', store=session['store']) }}">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</a></li>
            <li><a href="{{ url_for('main_routes.money_management', store=session['store']) }}">ãŠé‡£ã‚Šç®¡ç†</a></li>
            <li><a href="{{ url_for('main_routes.customer_management', store=session.get('store', 'nagano')) }}">é¡§å®¢ç®¡ç†</a></li>
            <li><a href="{{ url_for('gantt.gantt_chart', store=session.get('store', 'nagano')) }}">ã‚¿ã‚¤ãƒ ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</a></li>
            {% if session['user_role'] == 'ã‚¹ã‚¿ãƒƒãƒ•' %}
                <li><a href="{{ url_for('main_routes.pickup_register', store=session['store']) }}" class="nav-link">é€è¿ç™»éŒ²</a></li>
                
                <!-- é …ç›®ç™»éŒ²ã®éšå±¤ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
                <li class="nav-parent">
                    <a href="#" class="nav-parent-link" onclick="toggleSubmenu(event, 'item-register')">
                        <span>é …ç›®ç™»éŒ²</span>
                        <span class="nav-arrow">â–¶</span>
                    </a>
                    <ul class="nav-submenu" id="item-register">
                        <li><a href="/{{ session['store'] }}/settings">âš™ï¸ è¨­å®š</a></li>
                        <li><a href="{{ url_for('rs_main', store=session.get('store', 'nagano')) }}">ğŸ“… äºˆç´„è¨­å®š</a></li>
                        <li><a href="{{ url_for('main_routes.register_staff', store=session.get('store', 'nagano')) }}">ã‚¹ã‚¿ãƒƒãƒ•</a></li>
                        <li><a href="{{ url_for('main_routes.cast_management', store=session.get('store', 'nagano')) }}">ã‚­ãƒ£ã‚¹ãƒˆ</a></li>
                        <li><a href="{{ url_for('main_routes.register_course', store=session.get('store', 'nagano')) }}">ã‚³ãƒ¼ã‚¹</a></li>
                        <li><a href="{{ url_for('main_routes.options', store=session.get('store', 'nagano')) }}">ã‚ªãƒ—ã‚·ãƒ§ãƒ³</a></li>
                        <li><a href="{{ url_for('main_routes.discount_management', store=session.get('store', 'nagano')) }}">å‰²å¼•</a></li>
                        <li><a href="{{ url_for('main_routes.rating_items_management', store=session.get('store', 'nagano')) }}">è©•ä¾¡é …ç›®</a></li>
                        <li><a href="{{ url_for('main_routes.register_hotel', store=session.get('store', 'nagano')) }}">ãƒ›ãƒ†ãƒ«</a></li>
                    </ul>
                </li>
                
            {% endif %}
            
            <li><a href="{{ url_for('schedule.cast_schedule', store=session['store']) }}">å‡ºå‹¤ç®¡ç†</a></li>
            <li><a href="{{ url_for('notice_admin.list_notices', store=session['store']) }}">ãŠçŸ¥ã‚‰ã›ç®¡ç†</a></li>
            <li><a href="/{{ session['store'] }}/cast/login">ã‚­ãƒ£ã‚¹ãƒˆãƒ­ã‚°ã‚¤ãƒ³</a></li>
            <li><a href="{{ url_for('main_routes.logout', store=session['store']) }}">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a></li>
        </ul>
    </nav>
    
    <main class="content">
        {% block content %}{% endblock %}
    </main>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
    
    <!-- å…±é€šJavaScripté–¢æ•° -->
    <script>
    // å…±é€šã®ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡é–¢æ•°
    function submitFormAction(actionData, targetUrl) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = targetUrl;
        
        Object.keys(actionData).forEach(key => {
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = key;
            input.value = actionData[key];
            form.appendChild(input);
        });
        
        document.body.appendChild(form);
        form.submit();
    }

    // ç·¨é›†ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆé–¢æ•°
    function toggleEditMode(type, id, isEdit) {
        const nameElement = document.getElementById(`${type}-name-${id}`);
        const editElement = document.getElementById(`${type}-edit-${id}`);
        const editBtn = document.querySelector(`[onclick="edit${type.charAt(0).toUpperCase() + type.slice(1)}(${id})"]`);
        const saveBtn = document.querySelector(`[onclick="save${type.charAt(0).toUpperCase() + type.slice(1)}(${id})"]`);
        const cancelBtn = document.querySelector(`[onclick="cancelEdit${type.charAt(0).toUpperCase() + type.slice(1)}(${id})"]`);
        
        if (isEdit) {
            nameElement.classList.add('hidden');
            editElement.classList.remove('hidden');
            editBtn.classList.add('hidden');
            saveBtn.classList.remove('hidden');
            cancelBtn.classList.remove('hidden');
        } else {
            nameElement.classList.remove('hidden');
            editElement.classList.add('hidden');
            editBtn.classList.remove('hidden');
            saveBtn.classList.add('hidden');
            cancelBtn.classList.add('hidden');
        }
    }

    // ã‚µãƒ–ãƒ¡ãƒ‹ãƒ¥ãƒ¼åˆ‡ã‚Šæ›¿ãˆé–¢æ•°
    function toggleSubmenu(event, submenuId) {
        event.preventDefault();
        
        const submenu = document.getElementById(submenuId);
        const arrow = event.currentTarget.querySelector('.nav-arrow');
        
        if (submenu.classList.contains('nav-submenu-open')) {
            // é–‰ã˜ã‚‹
            submenu.classList.remove('nav-submenu-open');
            arrow.textContent = 'â–¶';
        } else {
            // é–‹ã
            submenu.classList.add('nav-submenu-open');
            arrow.textContent = 'â–¼';
        }
    }

    // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤æ©Ÿèƒ½ï¼ˆã‚¹ãƒãƒ›ç‰ˆã®ã¿ï¼‰
    document.addEventListener('DOMContentLoaded', function() {
        const navOverlay = document.querySelector('.nav-overlay');
        
        // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã®ã‚¯ãƒªãƒƒã‚¯å‡¦ç†ï¼ˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‰ã˜ã‚‹ï¼‰
        if (navOverlay) {
            navOverlay.addEventListener('click', function() {
                const navMenu = document.querySelector('.nav-menu');
                navMenu.classList.remove('active');
                navOverlay.classList.remove('active');
            });
        }
        
        // æ—¢å­˜ã®ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ‹¡å¼µ
        const hamburgerMenu = document.querySelector('.hamburger-menu');
        if (hamburgerMenu) {
            hamburgerMenu.addEventListener('click', function() {
                // script.jsã®å‡¦ç†ãŒå®Ÿè¡Œã•ã‚ŒãŸå¾Œã«ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚‚åˆ¶å¾¡
                setTimeout(function() {
                    const navMenu = document.querySelector('.nav-menu');
                    if (navMenu.classList.contains('active')) {
                        navOverlay.classList.add('active');
                    } else {
                        navOverlay.classList.remove('active');
                    }
                }, 10);
            });
        }
        
        // ãƒ¡ãƒ‹ãƒ¥ãƒ¼å†…ã®ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸæ™‚ã‚‚ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‰ã˜ã‚‹
        const navLinks = document.querySelectorAll('.nav-menu a:not(.nav-parent-link)');
        navLinks.forEach(function(link) {
            link.addEventListener('click', function() {
                const navMenu = document.querySelector('.nav-menu');
                navMenu.classList.remove('active');
                navOverlay.classList.remove('active');
            });
        });
    });
    </script>

    {% block extra_scripts %}{% endblock %}

</body>
</html>