{% extends "base.html" %}

{% block title %}
  コース編集 | {{ display_name }}
{% endblock %}

{% block content %}

<div class="container">
  <h1>コース編集</h1>

  {% if error %}
    <div class="alert alert-danger">{{ error }}</div>
  {% endif %}

  <div class="form-section">
    <form method="post" action="{{ url_for('main_routes.edit_course', store=store, course_id=course.course_id) }}">
      <div class="form-group">
        <label for="name" class="form-label">コース名 (必須):</label>
        <input type="text" class="form-control" id="name" name="name" value="{{ course.name }}" required placeholder="例）プレミアムコース">
      </div>
      
      <div class="form-group">
        <label for="category_id" class="form-label">コースカテゴリ (必須):</label>
        <select class="form-control" id="category_id" name="category_id" required>
          <option value="">カテゴリを選択してください</option>
          {% for category in categories %}
            <option value="{{ category.category_id }}" 
              {% if category.category_id == course.category_id %}selected{% endif %}>
              {{ category.category_name }}
            </option>
          {% endfor %}
        </select>
      </div>
      
      <div class="form-group">
        <label for="time_minutes" class="form-label">時間（分） (必須):</label>
        <input type="number" class="form-control" id="time_minutes" name="time_minutes" value="{{ course.time_minutes }}" required placeholder="例）90" min="1">
      </div>
      
      <div class="form-group">
        <label for="price" class="form-label">料金（円） (必須):</label>
        <input type="number" class="form-control" id="price" name="price" value="{{ course.price or '' }}" required placeholder="例）18000" min="0">
      </div>
      
      <div class="form-group">
        <label for="cast_back_amount" class="form-label">バック金額（円） (必須):</label>
        <input type="number" class="form-control" id="cast_back_amount" name="cast_back_amount" value="{{ course.cast_back_amount or '' }}" required placeholder="例）7500" min="0">
      </div>
      
      <div class="form-group">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="is_active" name="is_active" 
            {% if course.is_active %}checked{% endif %}>
          <label class="form-check-label" for="is_active">
            有効にする
          </label>
        </div>
      </div>
      
      <div class="form-actions">
        <button type="submit" class="btn-register">更新</button>
        <a href="{{ url_for('main_routes.register_course', store=store) }}" class="btn btn-secondary">キャンセル</a>
        
        <!-- 削除ボタン -->
        <form method="post" action="{{ url_for('main_routes.delete_course', store=store, course_id=course.course_id) }}" style="display: inline; margin-left: 10px;">
          <button type="submit" class="btn btn-delete" onclick="return confirm('本当にこのコースを削除しますか？\\n削除したデータは復元できません。')">削除</button>
        </form>
      </div>
    </form>
  </div>

  <!-- 現在の設定確認表示 -->
  <div class="info-section" style="margin-top: 30px; padding: 20px; background-color: #f8f9fa; border-radius: 5px;">
    <h3>現在の設定</h3>
    <ul>
      <li><strong>コース名:</strong> {{ course.name }}</li>
      <li><strong>カテゴリ:</strong> {{ course.category_name or 'カテゴリなし' }}</li>
      <li><strong>時間:</strong> {{ course.time_minutes }}分</li>
      <li><strong>料金:</strong> {{ "{:,}".format(course.price) if course.price else '未設定' }}円</li>
      <li><strong>バック金額:</strong> {{ "{:,}".format(course.cast_back_amount) if course.cast_back_amount else '未設定' }}円</li>
      <li><strong>状態:</strong> 
        {% if course.is_active %}
          <span class="badge bg-success">有効</span>
        {% else %}
          <span class="badge bg-secondary">無効</span>
        {% endif %}
      </li>
    </ul>
  </div>

</div>

{% endblock %}