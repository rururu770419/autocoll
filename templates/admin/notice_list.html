{% extends "base.html" %}

{% block title %}ãŠçŸ¥ã‚‰ã›ç®¡ç†{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/notice_admin.css') }}">
{% endblock %}

{% block content %}
<div class="na-container">
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="na-header">
        <h1 class="na-title">ğŸ“¢ ãŠçŸ¥ã‚‰ã›ç®¡ç†</h1>
        <a href="{{ url_for('notice_admin.new_notice') }}" class="na-btn na-btn-primary">
            â• æ–°è¦ä½œæˆ
        </a>
    </div>

    <!-- ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="na-alert {% if category == 'success' %}na-alert-success{% else %}na-alert-error{% endif %}">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <!-- ãŠçŸ¥ã‚‰ã›ä¸€è¦§ -->
    {% if notices %}
        <div class="na-list">
            {% for notice in notices %}
            <div class="na-list-item">
                <div class="na-list-header">
                    <h3 class="na-list-title">{{ notice.title }}</h3>
                    <div class="na-list-badges">
                        {% if notice.is_pinned %}
                        <span class="na-badge na-badge-pinned">ğŸ“Œ ãƒ”ãƒ³ç•™ã‚</span>
                        {% endif %}
                        {% if notice.is_published %}
                        <span class="na-badge na-badge-published">âœ“ å…¬é–‹ä¸­</span>
                        {% else %}
                        <span class="na-badge na-badge-unpublished">éå…¬é–‹</span>
                        {% endif %}
                    </div>
                </div>
                
                <div class="na-list-meta">
                    ğŸ“… å…¬é–‹æ—¥æ™‚: {{ notice.published_at.strftime('%Yå¹´%mæœˆ%dæ—¥ %H:%M') if notice.published_at else 'æœªè¨­å®š' }}
                    ï½œ æ›´æ–°: {{ notice.updated_at.strftime('%Yå¹´%mæœˆ%dæ—¥ %H:%M') if notice.updated_at else '-' }}
                </div>
                
                <div class="na-list-content">
                    {{ notice.content|striptags|truncate(100) }}
                </div>
                
                <div class="na-list-actions">
                    <a href="{{ url_for('notice_admin.edit_notice', notice_id=notice.notice_id) }}" 
                       class="na-btn na-btn-edit">
                        âœï¸ ç·¨é›†
                    </a>
                    <button type="button" 
                            class="na-btn na-btn-delete" 
                            onclick="confirmDelete({{ notice.notice_id }}, '{{ notice.title }}')">
                        ğŸ—‘ï¸ å‰Šé™¤
                    </button>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <!-- ç©ºã®çŠ¶æ…‹ -->
        <div class="na-empty-state">
            <div class="na-empty-icon">ğŸ“­</div>
            <p class="na-empty-text">ãŠçŸ¥ã‚‰ã›ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“</p>
            <a href="{{ url_for('notice_admin.new_notice') }}" class="na-btn na-btn-primary">
                æœ€åˆã®ãŠçŸ¥ã‚‰ã›ã‚’ä½œæˆã™ã‚‹
            </a>
        </div>
    {% endif %}
</div>

<!-- å‰Šé™¤ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="deleteModal" class="na-modal-overlay">
    <div class="na-modal-content">
        <div class="na-modal-header">
            <h3 class="na-modal-title">âš ï¸ å‰Šé™¤ç¢ºèª</h3>
        </div>
        <div class="na-modal-body">
            <p>ã€Œ<strong id="deleteNoticeName"></strong>ã€ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ</p>
            <p style="color: #dc3545; margin-top: 10px;">ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚</p>
        </div>
        <div class="na-modal-footer">
            <button type="button" class="na-btn na-btn-secondary" onclick="closeDeleteModal()">
                ã‚­ãƒ£ãƒ³ã‚»ãƒ«
            </button>
            <form id="deleteForm" method="POST" style="display: inline;">
                <button type="submit" class="na-btn na-btn-delete">
                    å‰Šé™¤ã™ã‚‹
                </button>
            </form>
        </div>
    </div>
</div>

<script>
// å‰Šé™¤ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ«
function confirmDelete(noticeId, noticeName) {
    document.getElementById('deleteNoticeName').textContent = noticeName;
    document.getElementById('deleteForm').action = "{{ url_for('notice_admin.delete_notice_route', notice_id=0) }}".replace('0', noticeId);
    document.getElementById('deleteModal').classList.add('na-modal-show');
}

function closeDeleteModal() {
    document.getElementById('deleteModal').classList.remove('na-modal-show');
}

// ãƒ¢ãƒ¼ãƒ€ãƒ«å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
document.getElementById('deleteModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeDeleteModal();
    }
});
</script>
{% endblock %}