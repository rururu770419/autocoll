{% extends "base.html" %}

{% block extra_head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/gantt_chart.css') }}">
{% endblock %}

{% block title %}ã‚¿ã‚¤ãƒ ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ« - {{ date_display }}{% endblock %}

{% block content %}
<div class="gantt-container">
  <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
  <div class="gantt-header">
    <h1 class="gantt-title">ğŸ“… ã‚¿ã‚¤ãƒ ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</h1>
    
    <!-- æ—¥ä»˜ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
    <div class="gantt-controls">
      <a href="{{ url_for('gantt.gantt_chart', store=store, date=prev_date) }}" class="gantt-nav-btn">
        â† å‰æ—¥
      </a>
      <div class="gantt-date-display">
        {{ date_display }}
      </div>
      <a href="{{ url_for('gantt.gantt_chart', store=store, date=next_date) }}" class="gantt-nav-btn">
        ç¿Œæ—¥ â†’
      </a>
    </div>
  </div>

  <!-- ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆæœ¬ä½“ -->
  <div class="gantt-body">
    <div class="gantt-wrapper">
      <!-- å·¦å´ï¼šã‚­ãƒ£ã‚¹ãƒˆåä¸€è¦§ï¼ˆå›ºå®šï¼‰ -->
      <div class="gantt-cast-column">
        <div class="gantt-cast-header">ã‚­ãƒ£ã‚¹ãƒˆ</div>
        {% for cast in gantt_data.casts %}
        <div class="gantt-cast-cell">
          <span class="gantt-cast-name">{{ cast.cast_name }}</span>
          <span class="gantt-cast-time">
            {% if cast.start_time %}
              {{ cast.start_time[:5] }}ï½{{ cast.end_time[:5] }}
            {% else %}
              å‡ºå‹¤æ™‚é–“æœªè¨­å®š
            {% endif %}
          </span>
        </div>
        {% endfor %}
        
        {% if gantt_data.casts|length == 0 %}
        <div class="gantt-no-data">
          æœ¬æ—¥ã®å‡ºå‹¤ã‚­ãƒ£ã‚¹ãƒˆã¯ã„ã¾ã›ã‚“
        </div>
        {% endif %}
      </div>

      <!-- å³å´ï¼šã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ï¼ˆã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ï¼‰ -->
      <div class="gantt-timeline-wrapper">
        <!-- æ™‚é–“è»¸ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆJavaScriptã§å‹•çš„ç”Ÿæˆï¼‰ -->
        <div class="gantt-timeline-header" id="ganttTimelineHeader">
          <!-- JavaScriptã§ç”Ÿæˆ -->
        </div>

        <!-- ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³æœ¬ä½“ -->
        <div class="gantt-timeline-body" id="ganttTimelineBody">
          {% for cast in gantt_data.casts %}
          <div class="gantt-timeline-row" 
               data-cast-id="{{ cast.cast_id }}"
               data-start-time="{% if cast.start_time %}{{ cast.start_time[:5] }}{% endif %}"
               data-end-time="{% if cast.end_time %}{{ cast.end_time[:5] }}{% endif %}">
            
            <!-- å‡ºå‹¤æ™‚é–“ã®èƒŒæ™¯ï¼ˆJavaScriptã§ä½ç½®èª¿æ•´ï¼‰ -->
            {% if cast.start_time and cast.end_time %}
            <div class="gantt-work-bg" 
                 data-start="{{ cast.start_time[:5] }}"
                 data-end="{{ cast.end_time[:5] }}">
            </div>
            {% endif %}
            
            <!-- äºˆç´„ãƒãƒ¼ -->
            {% for reservation in cast.reservations %}
            <div class="gantt-reservation-bar" 
                 data-start="{{ reservation.start_time[:5] }}"
                 data-end="{{ reservation.end_time[:5] }}"
                 data-reservation-id="{{ reservation.reservation_id }}">
              <div class="gantt-reservation-content">
                <!-- ç·¨é›†ãƒœã‚¿ãƒ³ + ãŠå®¢æ§˜å -->
                <div class="gantt-reservation-header">
                  <a href="{{ url_for('reservation.edit_reservation', store=store, reservation_id=reservation.reservation_id) }}" 
                     class="gantt-edit-btn"
                     onclick="event.stopPropagation()">
                    ç·¨é›†
                  </a>
                  <span class="gantt-reservation-customer">{{ reservation.customer_name }}æ§˜</span>
                </div>
                
                <!-- äºˆç´„æ™‚é–“ -->
                <div class="gantt-reservation-time">{{ reservation.start_time[:5] }}ï½{{ reservation.end_time[:5] }}</div>
                
                <!-- ãƒ›ãƒ†ãƒ« + éƒ¨å±‹ç•ªå·å…¥åŠ› -->
                {% if reservation.hotel_name %}
                <div class="gantt-reservation-hotel-row">
                  <span class="gantt-hotel-name">{{ reservation.hotel_name }}</span>
                  <input type="text" 
                         class="gantt-room-number-input" 
                         value="{{ reservation.room_number or '' }}"
                         maxlength="3"
                         placeholder="___"
                         data-reservation-id="{{ reservation.reservation_id }}"
                         onclick="event.stopPropagation()"
                         onchange="updateRoomNumber(this)"
                         title="éƒ¨å±‹ç•ªå·ã‚’å…¥åŠ›">
                </div>
                {% endif %}
              </div>
            </div>
            {% endfor %}
            
            <!-- ã‚°ãƒªãƒƒãƒ‰ã¯JavaScriptã§å‹•çš„ç”Ÿæˆ -->
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</div>

<!-- å–¶æ¥­æ™‚é–“è¨­å®šã‚’JavaScriptã«æ¸¡ã™ -->
<div id="ganttConfig" 
     data-start-hour="{{ schedule_settings.start_time.split(':')[0] }}" 
     data-end-hour="{% if schedule_settings.end_time.split(':')[0]|int < schedule_settings.start_time.split(':')[0]|int %}{{ schedule_settings.end_time.split(':')[0]|int + 24 }}{% else %}{{ schedule_settings.end_time.split(':')[0] }}{% endif %}"
     data-interval="10"
     style="display: none;">
</div>

{% endblock %}

{% block extra_scripts %}
<script src="{{ url_for('static', filename='js/gantt_chart.js') }}"></script>
{% endblock %}