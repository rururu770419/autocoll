{% extends "base.html" %}

{% block extra_head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/cast_management.css') }}">
{% endblock %}

{% block title %}割引マスタ管理 - {{ display_name }}{% endblock %}

{% block content %}
<div class="container-fluid">
    <h2>割引マスタ管理</h2>
    
    <!-- メッセージエリア -->
    {% if success %}
        <div class="alert alert-success" role="alert">{{ success }}</div>
    {% endif %}
    {% if error %}
        <div class="alert alert-danger" role="alert">{{ error }}</div>
    {% endif %}
    
    <!-- 新規登録ボタン -->
    <div class="mb-3">
        <a href="{{ url_for('main_routes.register_discount', store=store) }}" class="btn btn-primary cast-btn-registration">
            新規登録
        </a>
    </div>
    
    <!-- 割引一覧テーブル -->
    <div class="card">

        <div class="card-body">
            {% if discounts %}
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>割引名</th>
                            <th>種類</th>
                            <th>割引値</th>
                            <th>ステータス</th>
                            <th>登録日</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for discount in discounts %}
                        <tr>
                            <!-- 割引名 -->
                            <td>{{ discount.name }}</td>
                            
                            <!-- 種類 -->
                            <td>
                                {% if discount.discount_type == 'fixed' %}
                                    <span class="badge badge-primary">固定金額</span>
                                {% else %}
                                    <span class="badge badge-info">パーセント</span>
                                {% endif %}
                            </td>
                            
                            <!-- 割引値 -->
                            <td>
                                {% if discount.discount_type == 'fixed' %}
                                    {{ discount.value | int }}円
                                {% else %}
                                    {{ discount.value | int }}%
                                {% endif %}
                            </td>
                            
                            <!-- ステータス -->
                            <td>
                                <span class="badge 
                                    {% if discount.is_active %}badge-success
                                    {% else %}badge-secondary{% endif %}">
                                    {{ '有効' if discount.is_active else '無効' }}
                                </span>
                            </td>
                            
                            <!-- 登録日 -->
                            <td>
                                {{ discount.created_at.strftime('%Y/%m/%d') if discount.created_at else '-' }}
                            </td>
                            
                            <!-- 操作 -->
                            <td>
                                <a href="{{ url_for('main_routes.edit_discount', store=store, discount_id=discount.discount_id) }}" 
                                   class="btn btn-sm btn-outline-primary btn-edit">
                                    編集
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <div class="alert alert-info" role="alert">
                    <i class="fas fa-info-circle"></i>
                    割引が登録されていません。「新規登録」ボタンから最初の割引を登録してください。
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}